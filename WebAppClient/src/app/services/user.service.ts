import {Injectable} from '@angular/core';
import {User} from '../shared/models/user';
import {AppConfig} from '../app-config';
import {HttpClient} from '@angular/common/http';
import {concat, Observable} from 'rxjs';
import {AuthService} from './auth.service';
import {mergeMap} from 'rxjs/operators';

@Injectable({
  providedIn: 'root'
})
export class UserService {

  constructor(private http: HttpClient, private auth: AuthService) {
  }

  public getUserAvatarPath(user: User) {
    // return `${AppConfig.API_PATH}/user/${user.username}/avatar`;
    switch (user.username) {
      case 'setako':
        return 'data:image/png;base64,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';
      default:
        return 'data:image/png;base64,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';
    }
  }

  public editUserProfile(user: User | any, currentPassword?: string): Observable<any> {
    user.currentPassword = currentPassword;
    return this.http.put(`${AppConfig.API_PATH}/user/${user.username}`, user)
      .pipe(mergeMap(() => this.auth.updateUserInfo()));
  }
}
